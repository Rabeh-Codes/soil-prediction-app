# üöÄ Development Dockerfile (Final Version)
# ‚úÖ Tested & Verified - No Errors

# 1Ô∏è‚É£ Base image with Node.js 20 (Alpine for lightweight)
FROM node:20-alpine

# 2Ô∏è‚É£ Install essential build dependencies + update npm
RUN apk add --no-cache \
    bash \
    curl \
    python3 \
    make \
    g++ \
    && npm install -g npm@latest

# 3Ô∏è‚É£ Set working directory (absolute path)
WORKDIR /usr/src/app

# 4Ô∏è‚É£ Copy dependency files first (optimize caching)
COPY package.json package-lock.json ./

# 5Ô∏è‚É£ Install dependencies (ci for clean installs, fallback to install)
RUN npm ci --legacy-peer-deps --no-audit || npm install --legacy-peer-deps --no-audit

# 6Ô∏è‚É£ Copy the rest of the project files
COPY . .

# 7Ô∏è‚É£ Set development environment
ENV NODE_ENV=development

# 8Ô∏è‚É£ Expose dev server port
EXPOSE 3000

# 9Ô∏è‚É£ Healthcheck for Vite dev server
HEALTHCHECK --interval=30s --timeout=5s --start-period=10s --retries=3 \
  CMD curl -fsS http://localhost:3000 || exit 1

# üîü Start Vite dev server (with host binding)
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0", "--port", "3000"]
